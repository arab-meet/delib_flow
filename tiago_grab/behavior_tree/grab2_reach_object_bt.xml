<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4" main_tree_to_execute="Reach">
  <BehaviorTree ID="Reach">
    <Sequence>
      <GetTrajectoryFromYAML trajectory_name="grip_open" package_name="tiago_grab" config_file="tiago_positions" trajectory="{open_traj}"/>
      <GetTrajectoryFromYAML trajectory_name="grip_close" package_name="tiago_grab" config_file="tiago_positions" trajectory="{close_traj}"/>
      <GetTrajectoryFromYAML trajectory_name="arm_home" package_name="tiago_grab" config_file="tiago_positions" trajectory="{arm_home_traj}"/>

      <SaySomething name="Print message" message="Reaching object..."/>

      <ComputeTopDownGrasp object_pose="{target_pose}" pregrasp="{pregrasp_pose}" grasp="{grasp_pose}"/>

      <ComputePlanToTargetIK name="Plan to pre-grasp pose" target_ik="{pregrasp_pose}" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{arm_controller_action}" name="Move to pre-grasp pose" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{gripper_controller_action}" name="Open Gripper" trajectory="{open_traj}"/>

      <ComputePlanToTargetIK name="Plan to grasp pose" target_ik="{grasp_pose}" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{arm_controller_action}" name="Move to grasp pose" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{gripper_controller_action}" name="Close Gripper" trajectory="{close_traj}"/>

      <SaySomething name="Print message" message="Object Reached"/>

      <!-- <SaySomething name="Print message" message="Retracting arm"/> -->
      <!-- TODO: We should set target joint configuration to the planner instead of interpolating directly -->
      <!-- <FollowJointTrajectory action_name="{arm_controller_action}" name="Retract" trajectory="{arm_home_traj}"/> -->

    </Sequence>
  </BehaviorTree>
</root>
