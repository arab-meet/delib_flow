<root BTCPP_format="4">
  <BehaviorTree ID="MainTree">
    <Sequence>
      <Script code="
        arm_action:='arm_controller/follow_joint_trajectory';
        head_action:='head_controller/follow_joint_trajectory';
        torso_action:='torso_controller/follow_joint_trajectory';
        head_action:='head_controller/follow_joint_trajectory';
        torso_action:='torso_controller/follow_joint_trajectory'"/>

      <!-- TODO(Load Pre-defined Targets from a yaml file) -->
      <Script code="
        grab_goal_1:='0;base_link;0.5;0.0;0.7;0.0;0.707;0.0;0.707';
        grab_goal_2:='0;base_link;0.4;-0.3;0.6;0.0;0.707;0.0;0.707';
        Center:='0;map;0.2;0.0;0.0;0.0;0.0;0.0;1.0';
        Office:='0;map;-7.0;5.0;0.0;0.0;0.0;0.0;1.0';
        Kitchen:='0;map;6.0;5.0;0.0;0.0;0.0;0.0;1.0'"/>

      <!-- Go to Office -->
      <!-- <NavigateToPose name="GetBackToTheCenter" goal="{Center}"/> -->
      <NavigateToPose name="ToOffice" goal="{Office}"/>

      <!-- Move your Head around-->
      <GetTrajectoryFromYAML trajectory_name="sweeping" package_name="tiago_grab" config_file="tiago_head" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{head_action}" trajectory="{trajectory_msg}"/>

      <!-- Move your Torso Up -->
      <GetTrajectoryFromYAML trajectory_name="upward" package_name="tiago_grab" config_file="tiago_torso" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{torso_action}" trajectory="{trajectory_msg}"/>

      <!-- Move your Torso Down -->
      <GetTrajectoryFromYAML trajectory_name="downward" package_name="tiago_grab" config_file="tiago_torso" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory action_name="{torso_action}" trajectory="{trajectory_msg}"/>

      <!-- Move your arm -->
      <ComputePlanToTargetIK target_ik="{grab_goal_1}" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory name="Arm controller" action_name="{arm_action}" trajectory="{trajectory_msg}"/>

      <!-- Move to another Spot -->
      <!-- <NavigateToPose name="ToKitchen" goal="{Kitchen}"/> -->
      <ComputePlanToTargetIK target_ik="{grab_goal_2}" trajectory="{trajectory_msg}"/>
      <FollowJointTrajectory name="Arm controller" action_name="{arm_action}" trajectory="{trajectory_msg}"/>

    </Sequence>
  </BehaviorTree>
</root>
